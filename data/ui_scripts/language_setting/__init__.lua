local localization = {
    english = {
        LANGUAGE_BUTTON = "Language",
        LANGUAGE_BUTTON_DESC = "Change your game language.",
        POPUP_RESTART_REQUIRED_TITLE = "RESTART REQUIRED",
        POPUP_RESTART_REQUIRED_TEXT = "WARNING: To work properly, you need to have your language's zone files in the zone directory of your game root.\n\nYou have changed your game language, do you wish to restart?",
        POPUP_NO_ZONE_FOUND_TITLE = "LANGUAGE NOT FOUND",
        POPUP_NO_ZONE_FOUND_TEXT = "We are unable to find the language folder you have selected. To avoid bugs, we will not change anything.",
        LANG_ENGLISH = "English",
        LANG_FRENCH = "French",
        LANG_ITALIAN = "Italian",
        LANG_GERMAN = "German",
        LANG_SPANISH = "Spanish",
        LANG_JAPANESE_PARTIAL = "Japanese",
        LANG_KOREAN = "Korean",
        LANG_POLISH = "Polish",
        LANG_PORTUGUESE = "Portuguese",
        LANG_RUSSIAN = "Russian",
        LANG_SIMPLIFIED_CHINESE = "Simplified Chinese",
        LANG_TRADITIONAL_CHINESE = "Traditional Chinese",
        LANG_ENGLISH_SAFE = "Arabic"
    },
    french = {
        LANGUAGE_BUTTON = "Langue",
        LANGUAGE_BUTTON_DESC = "Changez la langue de votre jeu.",
        POPUP_RESTART_REQUIRED_TITLE = "REDÉMARRAGE REQUIS",
        POPUP_RESTART_REQUIRED_TEXT = "ATTENTION : Pour fonctionner correctement, vous devez avoir les fichiers de zone de votre langue dans le répertoire de zone de la racine de votre jeu.\n\nVous avez changé la langue de votre jeu, souhaitez-vous redémarrer ?",
        POPUP_NO_ZONE_FOUND_TITLE = "LANGUE INTROUVABLE",
        POPUP_NO_ZONE_FOUND_TEXT = "Nous ne parvenons pas à trouver le dossier de langue que vous avez sélectionné. Pour éviter les bugs, nous ne changerons rien.",
        LANG_ENGLISH = "Anglais",
        LANG_FRENCH = "Français",
        LANG_ITALIAN = "Italien",
        LANG_GERMAN = "Allemand",
        LANG_SPANISH = "Espagnol",
        LANG_JAPANESE_PARTIAL = "Japonais",
        LANG_KOREAN = "Coréen",
        LANG_POLISH = "Polonais",
        LANG_PORTUGUESE = "Portugais",
        LANG_RUSSIAN = "Russe",
        LANG_SIMPLIFIED_CHINESE = "Chinois simplifié",
        LANG_TRADITIONAL_CHINESE = "Chinois traditionnel",
        LANG_ENGLISH_SAFE = "Arabe"
    },
    italian = {
        LANGUAGE_BUTTON = "Lingua",
        LANGUAGE_BUTTON_DESC = "Cambia la tua lingua di gioco.",
        POPUP_RESTART_REQUIRED_TITLE = "RIPARTENZA RICHIESTA",
        POPUP_RESTART_REQUIRED_TEXT = "ATTENZIONE: per funzionare correttamente, devi avere i file di zona della tua lingua nella directory zone della tua root di gioco.\n\nHai cambiato la lingua del gioco, desideri riavviare?",
        POPUP_NO_ZONE_FOUND_TITLE = "LINGUA NON TROVATA",
        POPUP_NO_ZONE_FOUND_TEXT = "Non siamo in grado di trovare la cartella della lingua che hai selezionato. Per evitare bug, non cambieremo nulla.",
        LANG_ENGLISH = "Inglese",
        LANG_FRENCH = "Francese",
        LANG_ITALIAN = "Italiano",
        LANG_GERMAN = "Tedesco",
        LANG_SPANISH = "Spagnolo",
        LANG_JAPANESE_PARTIAL = "Giapponese",
        LANG_KOREAN = "Coreano",
        LANG_POLISH = "Polacco",
        LANG_PORTUGUESE = "Portoghese",
        LANG_RUSSIAN = "Russo",
        LANG_SIMPLIFIED_CHINESE = "Cinese semplificato",
        LANG_TRADITIONAL_CHINESE = "Cinese tradizionale",
        LANG_ENGLISH_SAFE = "Arabo"
    },
    german = {
        LANGUAGE_BUTTON = "Sprache",
        LANGUAGE_BUTTON_DESC = "Ändern Sie Ihre Spielsprache.",
        POPUP_RESTART_REQUIRED_TITLE = "NEUSTART ERFORDERLICH",
        POPUP_RESTART_REQUIRED_TEXT = "WARNUNG: Um richtig zu funktionieren, müssen Sie die Zonendateien Ihrer Sprache im Zonenverzeichnis Ihres Spielstammverzeichnisses haben.\n\nDu hast deine Spielsprache geändert, möchtest du neu starten?",
        POPUP_NO_ZONE_FOUND_TITLE = "SPRACHE NICHT GEFUNDEN",
        POPUP_NO_ZONE_FOUND_TEXT = "Wir können den von Ihnen ausgewählten Sprachordner nicht finden. Um Fehler zu vermeiden, werden wir nichts ändern.",
        LANG_ENGLISH = "Englisch",
        LANG_FRENCH = "Französisch",
        LANG_ITALIAN = "Italienisch",
        LANG_GERMAN = "Deutsch",
        LANG_SPANISH = "Spanisch",
        LANG_JAPANESE_PARTIAL = "Japanisch",
        LANG_KOREAN = "Koreanisch",
        LANG_POLISH = "Polnisch",
        LANG_PORTUGUESE = "Portugiesisch",
        LANG_RUSSIAN = "Russisch",
        LANG_SIMPLIFIED_CHINESE = "Vereinfachtes Chinesisch",
        LANG_TRADITIONAL_CHINESE = "Traditionelles Chinesisch",
        LANG_ENGLISH_SAFE = "Arabisch"
    },
    spanish = {
        LANGUAGE_BUTTON = "Idioma",
        LANGUAGE_BUTTON_DESC = "Cambia el idioma de tu juego.",
        POPUP_RESTART_REQUIRED_TITLE = "REINICIO REQUERIDO",
        POPUP_RESTART_REQUIRED_TEXT = "ADVERTENCIA: para que funcione correctamente, debe tener los archivos de zona de su idioma en el directorio de zona de la raíz del juego.\n\nHa cambiado el idioma de su juego, ¿desea reiniciar?",
        POPUP_NO_ZONE_FOUND_TITLE = "IDIOMA NO ENCONTRADO",
        POPUP_NO_ZONE_FOUND_TEXT = "No podemos encontrar la carpeta de idioma que ha seleccionado. Para evitar errores, no cambiaremos nada.",
        LANG_ENGLISH = "Inglés",
        LANG_FRENCH = "Francés",
        LANG_ITALIAN = "Italiano",
        LANG_GERMAN = "Alemán",
        LANG_SPANISH = "Español",
        LANG_JAPANESE_PARTIAL = "Japonés",
        LANG_KOREAN = "Coreano",
        LANG_POLISH = "Polaco",
        LANG_PORTUGUESE = "Portugués",
        LANG_RUSSIAN = "Ruso",
        LANG_SIMPLIFIED_CHINESE = "Chino simplificado",
        LANG_TRADITIONAL_CHINESE = "Chino tradicional",
        LANG_ENGLISH_SAFE = "Árabe"
    },
    ["japanese_partial"] = {
        LANGUAGE_BUTTON = "言語",
        LANGUAGE_BUTTON_DESC = "ゲーム言語を変更する.",
        POPUP_RESTART_REQUIRED_TITLE = "再起動が必要",
        POPUP_RESTART_REQUIRED_TEXT = "警告: 正しく機能するには、ゲームルートのゾーンディレクトリに言語のゾーンファイルが必要です.\n\nゲーム言語を変更しましたが、再開しますか?",
        POPUP_NO_ZONE_FOUND_TITLE = "言語が見つかりません",
        POPUP_NO_ZONE_FOUND_TEXT = "選択した言語フォルダが見つかりません. バグを避けるため、何も変更しません.",
        LANG_ENGLISH = "英語",
        LANG_FRENCH = "フランス語",
        LANG_ITALIAN = "イタリア語",
        LANG_GERMAN = "ドイツ語",
        LANG_SPANISH = "スペイン語",
        LANG_JAPANESE_PARTIAL = "日本語",
        LANG_KOREAN = "韓国語",
        LANG_POLISH = "ポーランド語",
        LANG_PORTUGUESE = "ポルトガル語",
        LANG_RUSSIAN = "ロシア語",
        LANG_SIMPLIFIED_CHINESE = "簡略化された中国語",
        LANG_TRADITIONAL_CHINESE = "繁体字中国語",
        LANG_ENGLISH_SAFE = "アラビア語"
    },
    korean = {
        LANGUAGE_BUTTON = "언어",
        LANGUAGE_BUTTON_DESC = "게임 언어 변경.",
        POPUP_RESTART_REQUIRED_TITLE = "재시작 필요",
        POPUP_RESTART_REQUIRED_TEXT = "경고: 제대로 작동하려면 게임 루트의 영역 디렉터리에 언어 영역 파일이 있어야 합니다.\n\n게임 언어를 변경했습니다. 다시 시작하시겠습니까?",
        POPUP_NO_ZONE_FOUND_TITLE = "언어를 찾을 수 없음",
        POPUP_NO_ZONE_FOUND_TEXT = "선택한 언어 폴더를 찾을 수 없습니다. 버그를 피하기 위해 우리는 아무것도 변경하지 않습니다.",
        LANG_ENGLISH = "영어",
        LANG_FRENCH = "프랑스어",
        LANG_ITALIAN = "이탈리아어",
        LANG_GERMAN = "독일어",
        LANG_SPANISH = "스페인어",
        LANG_JAPANESE_PARTIAL = "일본어",
        LANG_KOREAN = "한국어",
        LANG_POLISH = "폴란드어",
        LANG_PORTUGUESE = "포르투갈어",
        LANG_RUSSIAN = "러시아어",
        LANG_SIMPLIFIED_CHINESE = "중국어 간체",
        LANG_TRADITIONAL_CHINESE = "중국어 번체",
        LANG_ENGLISH_SAFE = "아랍어"
    },
    polish = {
        LANGUAGE_BUTTON = "Język",
        LANGUAGE_BUTTON_DESC = "Zmień język gry.",
        POPUP_RESTART_REQUIRED_TITLE = "WYMAGANE JEST PONOWNE URUCHOMIENIE",
        POPUP_RESTART_REQUIRED_TEXT = "OSTRZEŻENIE: Aby działać poprawnie, musisz mieć pliki stref swojego języka w katalogu stref w katalogu głównym gry.\n\nZmieniłeś język gry, czy chcesz uruchomić ponownie?",
        POPUP_NO_ZONE_FOUND_TITLE = "NIE ZNALEZIONO JĘZYKA",
        POPUP_NO_ZONE_FOUND_TEXT = "Nie możemy znaleźć wybranego folderu językowego. Aby uniknąć błędów, niczego nie zmienimy.",
        LANG_ENGLISH = "Angielski",
        LANG_FRENCH = "Francuski",
        LANG_ITALIAN = "Włoski",
        LANG_GERMAN = "Niemiecki",
        LANG_SPANISH = "Hiszpański",
        LANG_JAPANESE_PARTIAL = "Japoński",
        LANG_KOREAN = "Koreański",
        LANG_POLISH = "Polski",
        LANG_PORTUGUESE = "Portugalski",
        LANG_RUSSIAN = "Rosyjski",
        LANG_SIMPLIFIED_CHINESE = "Uproszczony chiński",
        LANG_TRADITIONAL_CHINESE = "Tradycyjny chiński",
        LANG_ENGLISH_SAFE = "Arabski"
    },
    portuguese = {
        LANGUAGE_BUTTON = "Idioma",
        LANGUAGE_BUTTON_DESC = "Altere o idioma do seu jogo.",
        POPUP_RESTART_REQUIRED_TITLE = "É NECESSÁRIO REINICIAR",
        POPUP_RESTART_REQUIRED_TEXT = "AVISO: Para funcionar corretamente, você precisa ter os arquivos de zona do seu idioma no diretório de zona da raiz do jogo.\n\nVocê alterou o idioma do jogo, deseja reiniciar?",
        POPUP_NO_ZONE_FOUND_TITLE = "IDIOMA NÃO ENCONTRADO",
        POPUP_NO_ZONE_FOUND_TEXT = "Não conseguimos encontrar a pasta de idioma que você selecionou. Para evitar bugs, não mudaremos nada.",
        LANG_ENGLISH = "Inglês",
        LANG_FRENCH = "Francês",
        LANG_ITALIAN = "Italiano",
        LANG_GERMAN = "Alemão",
        LANG_SPANISH = "Espanhol",
        LANG_JAPANESE_PARTIAL = "Japonês",
        LANG_KOREAN = "Coreano",
        LANG_POLISH = "Polonês",
        LANG_PORTUGUESE = "Português",
        LANG_RUSSIAN = "Russo",
        LANG_SIMPLIFIED_CHINESE = "Chinês simplificado",
        LANG_TRADITIONAL_CHINESE = "Chinês tradicional",
        LANG_ENGLISH_SAFE = "Árabe"
    },
    russian = {
        LANGUAGE_BUTTON = "Язык",
        LANGUAGE_BUTTON_DESC = "Изменить язык игры.",
        POPUP_RESTART_REQUIRED_TITLE = "ТРЕБУЕТСЯ ПЕРЕЗАПУСК",
        POPUP_RESTART_REQUIRED_TEXT = "ВНИМАНИЕ: Для правильной работы необходимо, чтобы файлы вашей локализации находились по пути zone/[название-языка] внутри корневой папки игры.\n\nВы изменили язык игры, хотите перезапустить ее?",
        POPUP_NO_ZONE_FOUND_TITLE = "ЛОКАЛИЗАЦИЯ НЕ НАЙДЕНА",
        POPUP_NO_ZONE_FOUND_TEXT = "Не удалось найти папку локализации на выбранном языке. Во избежание ошибок настройки останутся без изменений.",
        LANG_ENGLISH = "Английский",
        LANG_FRENCH = "Французский",
        LANG_ITALIAN = "Итальянский",
        LANG_GERMAN = "Немецкий",
        LANG_SPANISH = "Испанский",
        LANG_RUSSIAN = "Русский",
        LANG_POLISH = "Польский",
        LANG_JAPANESE_PARTIAL = "Японский",
        LANG_KOREAN = "Корейский",
        LANG_SIMPLIFIED_CHINESE = "Китайский (упрощенный)",
        LANG_TRADITIONAL_CHINESE = "Китайский (традиционный)",
        LANG_ENGLISH_SAFE = "Арабский",
        LANG_PORTUGUESE = "Португальский"
    },
    ["simplified_chinese"] = {
        LANGUAGE_BUTTON = "语言",
        LANGUAGE_BUTTON_DESC = "更改游戏语言.",
        POPUP_RESTART_REQUIRED_TITLE = "需要重新启动",
        POPUP_RESTART_REQUIRED_TEXT = "警告: 要正常工作, 您需要在游戏根目录的区域目录中保存您的语言区域文件.\n\n您已更改游戏语言，是否要重新启动?",
        POPUP_NO_ZONE_FOUND_TITLE = "未找到语言",
        POPUP_NO_ZONE_FOUND_TEXT = "我们找不到您选择的语言文件夹. 为避免错误，我们不会更改任何内容.",
        LANG_ENGLISH = "英语",
        LANG_FRENCH = "法语",
        LANG_ITALIAN = "意大利语",
        LANG_GERMAN = "德语",
        LANG_SPANISH = "西班牙语",
        LANG_JAPANESE_PARTIAL = "日语",
        LANG_KOREAN = "韩语",
        LANG_POLISH = "波兰语",
        LANG_PORTUGUESE = "葡萄牙语",
        LANG_RUSSIAN = "俄语",
        LANG_SIMPLIFIED_CHINESE = "简体中文",
        LANG_TRADITIONAL_CHINESE = "繁体中文",
        LANG_ENGLISH_SAFE = "阿拉伯语"
    },
    ["traditional_chinese"] = {
        LANGUAGE_BUTTON = "語言",
        LANGUAGE_BUTTON_DESC = "更改遊戲語言.",
        POPUP_RESTART_REQUIRED_TITLE = "需要重新啟動",
        POPUP_RESTART_REQUIRED_TEXT = "警告: 要正常工作，您需要在遊戲根目錄的區域目錄中保存您的語言區域文件.\n\n您已更改遊戲語言, 是否要重新啟動?",
        POPUP_NO_ZONE_FOUND_TITLE = "未找到語言",
        POPUP_NO_ZONE_FOUND_TEXT = "我們找不到您選擇的語言文件夾. 為避免錯誤, 我們不會更改任何內容.",
        LANG_ENGLISH = "英語",
        LANG_FRENCH = "法語",
        LANG_ITALIAN = "意大利語",
        LANG_GERMAN = "德語",
        LANG_SPANISH = "西班牙語",
        LANG_JAPANESE_PARTIAL = "日本人",
        LANG_KOREAN = "韓國人",
        LANG_POLISH = "拋光",
        LANG_PORTUGUESE = "葡萄牙語",
        LANG_RUSSIAN = "俄語",
        LANG_SIMPLIFIED_CHINESE = "簡體中文",
        LANG_TRADITIONAL_CHINESE = "繁體中文",
        LANG_ENGLISH_SAFE = "阿拉伯"
    },
    ["english_safe"] = {
        LANGUAGE_BUTTON = "اللغة",
        LANGUAGE_BUTTON_DESC = "قم بتغيير لغة لعبتك.",
        POPUP_RESTART_REQUIRED_TITLE = "مطلوب إعادة التشغيل",
        POPUP_RESTART_REQUIRED_TEXT = "تحذير: للعمل بشكل صحيح ، يجب أن يكون لديك ملفات منطقة لغتك في دليل المنطقة بجذر اللعبة. لقد قمت بتغيير لغة اللعبة ، هل ترغب في إعادة التشغيل؟",
        POPUP_NO_ZONE_FOUND_TITLE = "اللغة غير موجودة",
        POPUP_NO_ZONE_FOUND_TEXT = "لم نتمكن من العثور على مجلد اللغة الذي حددته. لتجنب الأخطاء ، لن نغير أي شيء.",
        LANG_ENGLISH = "الإنجليزية",
        LANG_FRENCH = "الفرنسية",
        LANG_ITALIAN = "الإيطالية",
        LANG_GERMAN = "الألمانية",
        LANG_SPANISH = "الإسبانية",
        LANG_JAPANESE_PARTIAL = "اليابانية",
        LANG_KOREAN = "الكورية",
        LANG_POLISH = "البولندية",
        LANG_PORTUGUESE = "البرتغالية",
        LANG_RUSSIAN = "الروسية",
        LANG_SIMPLIFIED_CHINESE = "الصينية المبسطة",
        LANG_TRADITIONAL_CHINESE = "صينية مبسطة",
        LANG_ENGLISH_SAFE = "العربية"
    }
}
local available_languages = {"english_safe", "simplified_chinese", "traditional_chinese", "english", "french", "german",
                             "italian", "japanese_partial", "korean", "polish", "portuguese", "russian", "spanish"}
local current_language = "english"

function get_current_language()
    current_language = game.getcurrentgamelanguage
end

function set_language(value)
    local file_path = "h1-mod/language.txt"
    local file = io.open(file_path, "w")
    file:write(value)
    file:close()
end

function does_zone_folder_exists(language)
    return io.directoryexists("zone/" .. language)
end

function create_fancy_text(menu)
    local template = {
        leftAnchor = false,
        topAnchor = false,
        rightAnchor = false,
        bottomAnchor = false,
        left = 150,
        width = 385,
        top = 150,
        height = 30,
        font = CoD.TextSettings.H1TitleFont.Font,
        horizontalAlignment = LUI.AdjustAlignmentForLanguage(LUI.Alignment.Left),
        verticalAlignment = LUI.VerticalAlignment.Top,
        alpha = 1
    }

    local texts = {"Jok \"Llama\" Arwent", "H1-MOD Contributor", "Location: UNDISCLOSED"}

    for i = 1, #texts do
        template.top = template.top + template.height + 5 * 1.2
        template.height = template.height * 0.75

        local text = LUI.UIText.new(template)
        menu:addElement(text)
        text:setText(texts[i])
        text:setTextStyle(CoD.TextStyle.MW1Title)
        text:setupAutoScaleText()
        text:setUsePulseFX(true, false)
        text:registerAnimationState("hide", {
            alpha = 0
        })
        text:animateInSequence({{"default", 5000 + (3 - i) * 1000}, {"hide", 1000}}, nil, true, true)
    end
end

function get_localized_string(key)
    return Engine.Localize(string.format("@LUA_MENU_LANGUAGE_%s_%s", Engine.ToUpperCase(current_language), key))
end

get_current_language()

for k, v in pairs(localization[current_language]) do
    game:addlocalizedstring(string.format("LUA_MENU_LANGUAGE_%s_%s", Engine.ToUpperCase(current_language), k), v)
end

LUI.addmenubutton("pc_controls", {
    index = 4,
    text = get_localized_string("LANGUAGE_BUTTON"),
    description = get_localized_string("LANGUAGE_BUTTON_DESC"),
    callback = function()
        LUI.FlowManager.RequestAddMenu(nil, "language_menu")
    end
})

LUI.MenuBuilder.registerType("language_menu", function(unk1)
    local menu;

    if Engine.InFrontend() and Engine.IsMultiplayer() then
        menu = LUI.MenuTemplate.new(unk1, {
            menu_title = Engine.ToUpperCase(get_localized_string("LANGUAGE_BUTTON")),
            exclusiveController = 0,
            persistentBackground = PersistentBackground.Variants.Depot
        })

        if Engine.GetDvarBool("virtualLobbyPresentable") then
            Cac.NotifyVirtualLobby("depot", 0)
            create_fancy_text(menu)
        end
    else
        menu = LUI.MenuTemplate.new(unk1, {
            menu_title = get_localized_string("LANGUAGE_BUTTON"),
            exclusiveController = 0
        })
    end

    for i = 1, #available_languages do
        menu:AddButton(get_localized_string(string.format("LANG_%s", Engine.ToUpperCase(available_languages[i]))),
            function()
                LUI.yesnopopup({
                    title = Engine.Localize(localization[current_language].POPUP_RESTART_REQUIRED_TITLE),
                    text = localization[current_language].POPUP_RESTART_REQUIRED_TEXT,
                    callback = function(result)
                        if (result) then
                            if not does_zone_folder_exists(available_languages[i]) then
                                LUI.confirmationpopup({
                                    title = localization[current_language].POPUP_NO_ZONE_FOUND_TITLE,
                                    text = localization[current_language].POPUP_NO_ZONE_FOUND_TEXT,
                                    buttontext = "OK",
                                    callback = function()
                                        LUI.FlowManager.RequestLeaveMenu(popup)
                                    end
                                })

                                return
                            end

                            set_language(available_languages[i])
                            updater.relaunch()
                        else
                            LUI.FlowManager.RequestLeaveMenu(popup)
                        end
                    end
                })
            end, available_languages[i] == current_language, true, nil, nil)
    end

    menu:AddBackButton(function(unk1)
        if Engine.InFrontend() and Engine.IsMultiplayer() then
            if Engine.GetDvarBool("virtualLobbyPresentable") then
                Cac.NotifyVirtualLobby("leave_depot", 0)
            end
        end

        Engine.PlaySound(CoD.SFX.MenuBack)
        LUI.FlowManager.RequestLeaveMenu(unk1)
    end)

    return menu
end)

if Engine.InFrontend() and Engine.IsMultiplayer() then
    VLobby.InitMenuMode("language_menu", VirtualLobbyModes.LUI_MODE_LOBBY, PersistentBackground.FadeFromBlackSlow,
        PersistentBackground.FadeFromBlackSlow)
end
