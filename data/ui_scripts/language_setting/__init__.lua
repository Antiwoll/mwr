local localization = {
    english = {
        LANGUAGE_BUTTON = "Language",
        LANGUAGE_BUTTON_DESC = "Change your game language.",
        POPUP_RESTART_REQUIRED_TITLE = "RESTART REQUIRED",
        POPUP_RESTART_REQUIRED_TEXT = "WARNING: To work properly, you need to have your language's zone files in the zone directory of your game root.\n\nYou have changed your game language, do you wish to restart?",
        POPUP_NO_ZONE_FOUND_TITLE = "LANGUAGE NOT FOUND",
        POPUP_NO_ZONE_FOUND_TEXT = "We are unable to find the language folder you have selected. To avoid bugs, we will not change anything.",
        LANG_ENGLISH = "English",
        LANG_FRENCH = "French",
        LANG_ITALIAN = "Italian",
        LANG_GERMAN = "German",
        LANG_SPANISH = "Spanish",
        LANG_JAPANESE = "Japanese",
        LANG_KOREAN = "Korean",
        LANG_POLISH = "Polish",
        LANG_PORTUGUESE = "Portuguese",
        LANG_RUSSIAN = "Russian",
        LANG_SIMPLIFIED_CHINESE = "Simplified Chinese",
        LANG_TRADITIONAL_CHINESE = "Traditional Chinese"
    },
    french = {
        LANGUAGE_BUTTON = "Langue",
        LANGUAGE_BUTTON_DESC = "Changez la langue de votre jeu.",
        POPUP_RESTART_REQUIRED_TITLE = "REDÉMARRAGE REQUIS",
        POPUP_RESTART_REQUIRED_TEXT = "ATTENTION : Pour fonctionner correctement, vous devez avoir les fichiers de zone de votre langue dans le répertoire de zone de la racine de votre jeu.\n\nVous avez changé la langue de votre jeu, souhaitez-vous redémarrer ?",
        POPUP_NO_ZONE_FOUND_TITLE = "LANGUE INTROUVABLE",
        POPUP_NO_ZONE_FOUND_TEXT = "Nous ne parvenons pas à trouver le dossier de langue que vous avez sélectionné. Pour éviter les bugs, nous ne changerons rien.",
        LANG_ENGLISH = "Anglais",
        LANG_FRENCH = "Français",
        LANG_ITALIAN = "Italien",
        LANG_GERMAN = "Allemand",
        LANG_SPANISH = "Espagnol",
        LANG_JAPANESE = "Japonais",
        LANG_KOREAN = "Coréen",
        LANG_POLISH = "Polonais",
        LANG_PORTUGUESE = "Portugais",
        LANG_RUSSIAN = "Russe",
        LANG_SIMPLIFIED_CHINESE = "Chinois simplifié",
        LANG_TRADITIONAL_CHINESE = "Chinois traditionnel"
    },
    italian = {
        LANGUAGE_BUTTON = "Lingua",
        LANGUAGE_BUTTON_DESC = "Cambia la tua lingua di gioco.",
        POPUP_RESTART_REQUIRED_TITLE = "RIPARTENZA RICHIESTA",
        POPUP_RESTART_REQUIRED_TEXT = "ATTENZIONE: per funzionare correttamente, devi avere i file di zona della tua lingua nella directory zone della tua root di gioco.\n\nHai cambiato la lingua del gioco, desideri riavviare?",
        POPUP_NO_ZONE_FOUND_TITLE = "LINGUA NON TROVATA",
        POPUP_NO_ZONE_FOUND_TEXT = "Non siamo in grado di trovare la cartella della lingua che hai selezionato. Per evitare bug, non cambieremo nulla.",
        LANG_ENGLISH = "Inglese",
        LANG_FRENCH = "Francese",
        LANG_ITALIAN = "Italiano",
        LANG_GERMAN = "Tedesco",
        LANG_SPANISH = "Spagnolo",
        LANG_JAPANESE = "Japanese",
        LANG_KOREAN = "Korean",
        LANG_POLISH = "Polish",
        LANG_PORTUGUESE = "Portuguese",
        LANG_RUSSIAN = "Russian",
        LANG_SIMPLIFIED_CHINESE = "Simplified Chinese",
        LANG_TRADITIONAL_CHINESE = "Traditional Chinese"
    },
    german = {
        LANGUAGE_BUTTON = "Sprache",
        LANGUAGE_BUTTON_DESC = "Ändern Sie Ihre Spielsprache.",
        POPUP_RESTART_REQUIRED_TITLE = "NEUSTART ERFORDERLICH",
        POPUP_RESTART_REQUIRED_TEXT = "WARNUNG: Um richtig zu funktionieren, müssen Sie die Zonendateien Ihrer Sprache im Zonenverzeichnis Ihres Spielstammverzeichnisses haben.\n\nDu hast deine Spielsprache geändert, möchtest du neu starten?",
        POPUP_NO_ZONE_FOUND_TITLE = "SPRACHE NICHT GEFUNDEN",
        POPUP_NO_ZONE_FOUND_TEXT = "Wir können den von Ihnen ausgewählten Sprachordner nicht finden. Um Fehler zu vermeiden, werden wir nichts ändern.",
        LANG_ENGLISH = "Englisch",
        LANG_FRENCH = "Französisch",
        LANG_ITALIAN = "Italienisch",
        LANG_GERMAN = "Deutsch",
        LANG_SPANISH = "Spanisch",
        LANG_JAPANESE = "Japanese",
        LANG_KOREAN = "Korean",
        LANG_POLISH = "Polish",
        LANG_PORTUGUESE = "Portuguese",
        LANG_RUSSIAN = "Russian",
        LANG_SIMPLIFIED_CHINESE = "Simplified Chinese",
        LANG_TRADITIONAL_CHINESE = "Traditional Chinese"
    },
    spanish = {
        LANGUAGE_BUTTON = "Idioma",
        LANGUAGE_BUTTON_DESC = "Cambia el idioma de tu juego.",
        POPUP_RESTART_REQUIRED_TITLE = "REINICIO REQUERIDO",
        POPUP_RESTART_REQUIRED_TEXT = "ADVERTENCIA: para que funcione correctamente, debe tener los archivos de zona de su idioma en el directorio de zona de la raíz del juego.\n\nHa cambiado el idioma de su juego, ¿desea reiniciar?",
        POPUP_NO_ZONE_FOUND_TITLE = "IDIOMA NO ENCONTRADO",
        POPUP_NO_ZONE_FOUND_TEXT = "No podemos encontrar la carpeta de idioma que ha seleccionado. Para evitar errores, no cambiaremos nada.",
        LANG_ENGLISH = "Inglés",
        LANG_FRENCH = "Francés",
        LANG_ITALIAN = "Italiano",
        LANG_GERMAN = "Alemán",
        LANG_SPANISH = "Español",
        LANG_JAPANESE = "Japanese",
        LANG_KOREAN = "Korean",
        LANG_POLISH = "Polish",
        LANG_PORTUGUESE = "Portuguese",
        LANG_RUSSIAN = "Russian",
        LANG_SIMPLIFIED_CHINESE = "Simplified Chinese",
        LANG_TRADITIONAL_CHINESE = "Traditional Chinese"
    },
    japanese_partial = {
        LANGUAGE_BUTTON = "言語",
        LANGUAGE_BUTTON_DESC = "ゲーム言語を変更する.",
        POPUP_RESTART_REQUIRED_TITLE = "再起動が必要",
        POPUP_RESTART_REQUIRED_TEXT = "警告: 正しく機能するには、ゲームルートのゾーンディレクトリに言語のゾーンファイルが必要です.\n\nゲーム言語を変更しましたが、再開しますか?",
        POPUP_NO_ZONE_FOUND_TITLE = "言語が見つかりません",
        POPUP_NO_ZONE_FOUND_TEXT = "選択した言語フォルダが見つかりません. バグを避けるため、何も変更しません.",
        LANG_ENGLISH = "英語",
        LANG_FRENCH = "フランス語",
        LANG_ITALIAN = "イタリアの",
        LANG_GERMAN = "ドイツ人",
        LANG_SPANISH = "スペイン語",
        LANG_JAPANESE = "日本",
        LANG_KOREAN = "韓国語",
        LANG_POLISH = "研磨",
        LANG_PORTUGUESE = "ポルトガル語",
        LANG_RUSSIAN = "ロシア",
        LANG_SIMPLIFIED_CHINESE = "簡略化された中国語",
        LANG_TRADITIONAL_CHINESE = "繁体字中国語"
    },
    korean = {
        LANGUAGE_BUTTON = "언어",
        LANGUAGE_BUTTON_DESC = "게임 언어 변경.",
        POPUP_RESTART_REQUIRED_TITLE = "재시작 필요",
        POPUP_RESTART_REQUIRED_TEXT = "경고: 제대로 작동하려면 게임 루트의 영역 디렉터리에 언어 영역 파일이 있어야 합니다.\n\n게임 언어를 변경했습니다. 다시 시작하시겠습니까?",
        POPUP_NO_ZONE_FOUND_TITLE = "언어를 찾을 수 없음",
        POPUP_NO_ZONE_FOUND_TEXT = "선택한 언어 폴더를 찾을 수 없습니다. 버그를 피하기 위해 우리는 아무것도 변경하지 않습니다.",
        LANG_ENGLISH = "영어",
        LANG_FRENCH = "프랑스 국민",
        LANG_ITALIAN = "이탈리아 사람",
        LANG_GERMAN = "독일 사람",
        LANG_SPANISH = "스페인의",
        LANG_JAPANESE = "일본어",
        LANG_KOREAN = "한국인",
        LANG_POLISH = "광택",
        LANG_PORTUGUESE = "포르투갈 인",
        LANG_RUSSIAN = "러시아인",
        LANG_SIMPLIFIED_CHINESE = "중국어 간체",
        LANG_TRADITIONAL_CHINESE = "중국어 번체"
    },
    polish = {
        LANGUAGE_BUTTON = "Język",
        LANGUAGE_BUTTON_DESC = "Zmień język gry.",
        POPUP_RESTART_REQUIRED_TITLE = "WYMAGANE JEST PONOWNE URUCHOMIENIE",
        POPUP_RESTART_REQUIRED_TEXT = "OSTRZEŻENIE: Aby działać poprawnie, musisz mieć pliki stref swojego języka w katalogu stref w katalogu głównym gry.\n\nZmieniłeś język gry, czy chcesz uruchomić ponownie?",
        POPUP_NO_ZONE_FOUND_TITLE = "NIE ZNALEZIONO JĘZYKA",
        POPUP_NO_ZONE_FOUND_TEXT = "Nie możemy znaleźć wybranego folderu językowego. Aby uniknąć błędów, niczego nie zmienimy.",
        LANG_ENGLISH = "Angielski",
        LANG_FRENCH = "Francuski",
        LANG_ITALIAN = "Włoski",
        LANG_GERMAN = "Niemiecki",
        LANG_SPANISH = "Hiszpański",
        LANG_JAPANESE = "Japoński",
        LANG_KOREAN = "Koreańczyk",
        LANG_POLISH = "Polski",
        LANG_PORTUGUESE = "Portugalczyk",
        LANG_RUSSIAN = "Rosyjski",
        LANG_SIMPLIFIED_CHINESE = "Chiński uproszczony",
        LANG_TRADITIONAL_CHINESE = "Tradycyjny chiński"
    },
    portuguese = {
        LANGUAGE_BUTTON = "Linguagem",
        LANGUAGE_BUTTON_DESC = "Altere o idioma do seu jogo.",
        POPUP_RESTART_REQUIRED_TITLE = "É NECESSÁRIO REINICIAR",
        POPUP_RESTART_REQUIRED_TEXT = "AVISO: Para funcionar corretamente, você precisa ter os arquivos de zona do seu idioma no diretório de zona da raiz do jogo.\n\nVocê alterou o idioma do jogo, deseja reiniciar?",
        POPUP_NO_ZONE_FOUND_TITLE = "IDIOMA NÃO ENCONTRADO",
        POPUP_NO_ZONE_FOUND_TEXT = "Não conseguimos encontrar a pasta de idioma que você selecionou. Para evitar bugs, não mudaremos nada.",
        LANG_ENGLISH = "Inglês",
        LANG_FRENCH = "Francês",
        LANG_ITALIAN = "Italiano",
        LANG_GERMAN = "Alemão",
        LANG_SPANISH = "Espanhol",
        LANG_JAPANESE = "Japonês",
        LANG_KOREAN = "Coreano",
        LANG_POLISH = "Polonês",
        LANG_PORTUGUESE = "Português",
        LANG_RUSSIAN = "Russo",
        LANG_SIMPLIFIED_CHINESE = "Chinês simplificado",
        LANG_TRADITIONAL_CHINESE = "Chinês tradicional"
    },
    russian = {
        LANGUAGE_BUTTON = "Язык",
        LANGUAGE_BUTTON_DESC = "Измените язык игры.",
        POPUP_RESTART_REQUIRED_TITLE = "ТРЕБУЕТСЯ ПЕРЕЗАПУСК",
        POPUP_RESTART_REQUIRED_TEXT = "ВНИМАНИЕ: для правильной работы файлы зон вашего языка должны находиться в каталоге зон в корне игры.\n\nВы изменили язык игры, хотите перезапустить?",
        POPUP_NO_ZONE_FOUND_TITLE = "ЯЗЫК НЕ НАЙДЕН",
        POPUP_NO_ZONE_FOUND_TEXT = "Мы не можем найти папку с выбранным вами языком. Во избежание багов ничего менять не будем.",
        LANG_ENGLISH = "Английский",
        LANG_FRENCH = "Французский",
        LANG_ITALIAN = "итальянский",
        LANG_GERMAN = "Немецкий",
        LANG_SPANISH = "испанский",
        LANG_JAPANESE = "Японский",
        LANG_KOREAN = "Корейский",
        LANG_POLISH = "польский",
        LANG_PORTUGUESE = "португальский",
        LANG_RUSSIAN = "Русский",
        LANG_SIMPLIFIED_CHINESE = "Упрощенный китайский",
        LANG_TRADITIONAL_CHINESE = "Традиционный китайский"
    },
    simplified_chinese = {
        LANGUAGE_BUTTON = "语",
        LANGUAGE_BUTTON_DESC = "更改游戏语言.",
        POPUP_RESTART_REQUIRED_TITLE = "需要重新启动",
        POPUP_RESTART_REQUIRED_TEXT = "警告: 要正常工作, 您需要在游戏根目录的区域目录中保存您的语言区域文件.\n\n您已更改游戏语言，是否要重新启动?",
        POPUP_NO_ZONE_FOUND_TITLE = "未找到语言",
        POPUP_NO_ZONE_FOUND_TEXT = "我们找不到您选择的语言文件夹. 为避免错误，我们不会更改任何内容.",
        LANG_ENGLISH = "英语",
        LANG_FRENCH = "法语",
        LANG_ITALIAN = "意大利语",
        LANG_GERMAN = "德语",
        LANG_SPANISH = "西班牙语",
        LANG_JAPANESE = "日本人",
        LANG_KOREAN = "韩国人",
        LANG_POLISH = "抛光",
        LANG_PORTUGUESE = "葡萄牙语",
        LANG_RUSSIAN = "俄语",
        LANG_SIMPLIFIED_CHINESE = "简体中文",
        LANG_TRADITIONAL_CHINESE = "繁体中文"
    },
    traditional_chinese = {
        LANGUAGE_BUTTON = "語",
        LANGUAGE_BUTTON_DESC = "更改遊戲語言.",
        POPUP_RESTART_REQUIRED_TITLE = "需要重新啟動",
        POPUP_RESTART_REQUIRED_TEXT = "警告: 要正常工作，您需要在遊戲根目錄的區域目錄中保存您的語言區域文件.\n\n您已更改遊戲語言, 是否要重新啟動?",
        POPUP_NO_ZONE_FOUND_TITLE = "未找到語言",
        POPUP_NO_ZONE_FOUND_TEXT = "我們找不到您選擇的語言文件夾. 為避免錯誤, 我們不會更改任何內容.",
        LANG_ENGLISH = "英語",
        LANG_FRENCH = "法語",
        LANG_ITALIAN = "意大利語",
        LANG_GERMAN = "德語",
        LANG_SPANISH = "西班牙語",
        LANG_JAPANESE = "日本人",
        LANG_KOREAN = "韓國人",
        LANG_POLISH = "拋光",
        LANG_PORTUGUESE = "葡萄牙語",
        LANG_RUSSIAN = "俄語",
        LANG_SIMPLIFIED_CHINESE = "簡體中文",
        LANG_TRADITIONAL_CHINESE = "繁體中文"
    }
}
local available_languages = {"english", "french", "italian", "german", "spanish", "japanese_partial", "korean", "polish", "portuguese", "russian", "simplified_chinese", "traditional_chinese"}
local actual_language = "english"

function get_actual_language()
    local file_path = "h1-mod/language.txt"
    local file = io.open(file_path, "r")

    if file == nil then
        return
    end

    local data = file:read("*a")
    actual_language = data
end

function set_language(value)
    local file_path = "h1-mod/language.txt"
    local file = io.open(file_path, "w")
    file:write(value)
    file:close()
end

function does_zone_folder_exists(language)
    return io.directoryexists("zone/" .. language)
end

get_actual_language()

LUI.addmenubutton("pc_controls", {
    index = game:issingleplayer() and 5 or 6,
    text = localization[actual_language].LANGUAGE_BUTTON,
    description = localization[actual_language].LANGUAGE_BUTTON_DESC,
    callback = function()
        LUI.FlowManager.RequestAddMenu(nil, "language_menu")
    end
})

LUI.MenuBuilder.registerType("language_menu", function(unk1)
    local menu = LUI.MenuTemplate.new(unk1, {
        menu_title = (localization[actual_language].LANGUAGE_BUTTON):upper(),
        exclusiveController = 0
    })

    for i = 1, #available_languages do
        menu:AddButton(localization[actual_language]["LANG_" .. available_languages[i]:upper()], function()
            LUI.yesnopopup({
                title = localization[available_languages[i]].POPUP_RESTART_REQUIRED_TITLE,
                text = localization[available_languages[i]].POPUP_RESTART_REQUIRED_TEXT,
                callback = function(result)
                    if (result) then
                        if not does_zone_folder_exists(available_languages[i]) then
                            LUI.confirmationpopup({
                                title = localization[available_languages[i]].POPUP_NO_ZONE_FOUND_TITLE,
                                text = localization[available_languages[i]].POPUP_NO_ZONE_FOUND_TEXT,
                                buttontext = "OK",
                                callback = function()
                                    LUI.FlowManager.RequestLeaveMenu(popup)
                                end
                            })

                            return
                        end

                        set_language(available_languages[i])
                        updater.relaunch()
                    else
                        LUI.FlowManager.RequestLeaveMenu(popup)
                    end
                end
            })
        end, nil, true, nil, nil)
    end

    menu:AddBackButton(function(unk1)
        Engine.PlaySound(CoD.SFX.MenuBack)
        LUI.FlowManager.RequestLeaveMenu(unk1)
    end)

    return menu
end)
